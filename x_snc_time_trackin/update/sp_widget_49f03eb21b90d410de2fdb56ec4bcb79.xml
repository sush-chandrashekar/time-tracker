<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($location, spModal, spUtil, $scope) {
    /* widget controller */
    var c = this;
    console.log(c.data.timeTrackers);
    c.data.dateTd = moment(c.data.dateTd).format("ddd, MMM Do");

    for (var index = 0; index < c.data.timeTrackers.length; index++) {
        c.data.timeTrackers[index].checkin = moment(c.data.timeTrackers[index].checkin).format("hA");
        c.data.timeTrackers[index].checkout = moment(c.data.timeTrackers[index].checkout).format("hA");
    }
    c.tdClicked = function(td) {
        $location.url('?id=time_tracking_clock_in&imt=' + td.imt + '&tr=' + td.sys_id);
    }

    c.trashClicked = function(td) {
        //ask the user for a string
        spModal.open({
            title: 'Removal of Time Entry',
            message: 'Are you sure you want to remove the time entry?',
            input: false,
        }).then(function() {
            c.data.confirmDelete = true;
            if (c.data.confirmDelete) {
                c.data.deleteRecord = td.sys_id;
                spUtil.update($scope);
            }
        });
    };
    spUtil.recordWatch($scope, "x_snc_time_trackin_time_tracker", "active=true", function(response) {
        spUtil.update($scope);
    });

};]]></client_script>
        <controller_as>c</controller_as>
        <css>.tt-each-day {&#13;
  h3 {&#13;
      margin-bottom: 20px;&#13;
      font-weight: bold;;&#13;
  }&#13;
  .each-td {&#13;
      height: 70px;&#13;
      width: 90%;&#13;
      padding: 20px;&#13;
      margin-left: auto;&#13;
      margin-right: auto;&#13;
      background-color: $brand-primary;&#13;
      font-size: 24px;&#13;
      margin-bottom: 10px;&#13;
      color: #fff;&#13;
      border-radius: 6px;&#13;
      .cal-icon {&#13;
          margin-right: 10px;&#13;
      }&#13;
      @media only screen and (min-device-width: 320px) and (max-device-width: 568px) and (-webkit-min-device-pixel-ratio: 2) {&#13;
&#13;
        height: 60px;&#13;
        width: 100%;&#13;
        padding: 15px;&#13;
        margin-left: auto;&#13;
        margin-right: auto;&#13;
        background-color: #1F8476;&#13;
        font-size: 17px;&#13;
        margin-bottom: 10px;&#13;
        color: #fff;&#13;
        border-radius: 6px;&#13;
        text-align: center;&#13;
      }&#13;
  }&#13;
&#13;
  .no-entries{&#13;
    font-size: 24px;&#13;
  }&#13;
}&#13;
&#13;
.trash-can {&#13;
float: right;&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>time_tracking_logs_each_day</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>Time Tracking Logs Each Day</name>
        <option_schema/>
        <public>false</public>
        <roles>x_snc_time_trackin.user</roles>
        <script><![CDATA[(function() {
    /* populate the 'data' object */
    /* e.g., data.table = $sp.getValue('table'); */
    var tdid = $sp.getParameter('tdid');
    data.timeTrackers = [];
    $sp.log("each day log");
    var gr = new GlideRecord('x_snc_time_trackin_time_tracker');
    //gr.addQuery('active',true);
    gr.addQuery('time_card_daily', tdid);
    gr.orderBy('check_in');
    gr.query();
    while (gr.next()) {
        var temp = {};
        temp.sys_id = gr.sys_id.toString();
        temp.duration = gr.getDisplayValue('duration');
        temp.checkin = gr.getDisplayValue('check_in');
        temp.checkout = gr.getDisplayValue('check_out');
        temp.type = gr.getDisplayValue('type');
        temp.imt = gr.getValue('parent');
        data.timeTrackers.push(temp);
        data.imtName = gr.parent.name.getDisplayValue();
        data.totalHrs = gr.time_card_daily.time_worked.getDisplayValue();
        data.dateTd = gr.getDisplayValue('time_card_daily');
    }

    //Remove Time card entry
    if (input && input.confirmDelete) {
        var grRemove = new GlideRecord('x_snc_time_trackin_time_tracker');
        grRemove.addQuery('sys_id', input.deleteRecord);
        grRemove.query();
        if (grRemove.next()) {
            grRemove.deleteRecord();
        }
    }

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>sush.chan</sys_created_by>
        <sys_created_on>2020-04-24 19:22:13</sys_created_on>
        <sys_id>49f03eb21b90d410de2fdb56ec4bcb79</sys_id>
        <sys_mod_count>73</sys_mod_count>
        <sys_name>Time Tracking Logs Each Day</sys_name>
        <sys_package display_value="Time Tracking" source="x_snc_time_trackin">54476f311b14d410b22663142a4bcbc6</sys_package>
        <sys_policy/>
        <sys_scope display_value="Time Tracking">54476f311b14d410b22663142a4bcbc6</sys_scope>
        <sys_update_name>sp_widget_49f03eb21b90d410de2fdb56ec4bcb79</sys_update_name>
        <sys_updated_by>brett.karl</sys_updated_by>
        <sys_updated_on>2020-05-01 13:39:04</sys_updated_on>
        <template><![CDATA[<div class="tt-each-day col-md-12">
<!-- your widget template -->
<div class="text-center"><h3><i class="fa fa-calendar" aria-hidden="true"></i> {{c.data.dateTd}}. Total {{c.data.totalHrs}} hrs</h3>
  <!-- <h3>Total {{c.data.totalHrs}} hrs</h3></div> -->
  <div class="each-td" ng-repeat="td in c.data.timeTrackers">
   <span class="cal-icon" ng-click="c.tdClicked(td)">
      <i ng-if="td.type == 'Work'" class="fa fa-laptop" aria-hidden="true"></i>
      <i ng-if="td.type == 'Lunch'" class="fa fa-cutlery" aria-hidden="true"></i>
      <i ng-if="td.type == 'Travel'" class="fa fa-car" aria-hidden="true"></i>
  </span>
   <span ng-click="c.tdClicked(td)">{{td.type}}</span> - <span class="date">{{td.checkin}} to {{td.checkout}}</span> - <span>Total: {{td.duration}} hrs</span>
    <div class="trash-can"><i class="fa fa-trash" ng-click="c.trashClicked(td,imt)"></i></div>
  </div>
  <div class="no-entries" ng-if="c.data.timeTrackers.length == 0">
    <p>No time entries found</p>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
